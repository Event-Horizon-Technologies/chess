name: Rust CI

on:
  pull_request:
    branches: [main]

jobs:
  check:

    runs-on: ubuntu-latest
    container:
      image: ghcr.io/event-horizon-technologies/chess:main
      credentials:
        username: ${{ github.actor }}
        password: ${{ secrets.GITHUB_TOKEN }}

    steps:
    - uses: actions/checkout@v3

    - name: Check Formatting
      run: cargo fmt -- --check

    - name: Build Desktop
      run: cd client && cargo build

    - name: Build WASM
      run: cd client && trunk build

    - name: Build Server
      run: cd server && cargo build

    - name: Run Client Tests
      run: cd client && cargo test --verbose
